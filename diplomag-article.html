<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Article â€“ Diplomag â€“ Diploval Conseil</title>
    <link rel="stylesheet" href="assets/css/main.css" />
    <style>
        .article-page {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
        }
        .article-page h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        .article-meta-line {
            font-size: 0.95rem;
            color: #4a90e2;
            margin-bottom: 12px;
        }
        .article-page img {
            max-width: 100%;
            border-radius: 1rem;
            margin: 20px 0;
        }

        .article-actions-top,
        .article-actions-bottom {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
            align-items: center;
        }

        .share-buttons a {
            font-size: 0.85rem;
        }

        /* Boutons simples si non dÃ©finis dans main.css */
        .btn-primary,
        .btn-secondary {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.45rem 0.9rem;
            border-radius: 999px;
            font-size: 0.85rem;
            border: 1px solid #0c2c50;
            background: #ffffff;
            color: #0c2c50;
            text-decoration: none;
            cursor: pointer;
            gap: 0.3rem;
        }

        .btn-primary {
            background: #0c2c50;
            color: #ffffff;
        }

        .btn-primary:hover {
            background: #4a90e2;
            border-color: #4a90e2;
        }

        .btn-secondary:hover {
            background: #f3f4f6;
        }

        /* Bloc de tÃ©lÃ©chargement PDF (version fine Diploval) */
        .download-box-thin {
            margin: 0.75rem 0 1rem;
            padding: 0.55rem 0.85rem;
            border-radius: 1rem;
            border: 1px solid rgba(12,44,80,0.16);
            background: rgba(247, 245, 241, 0.85);
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            font-size: 0.9rem;
        }

        .download-box-thin .download-icon {
            font-size: 1.1rem;
        }

        .download-box-thin .pdf-download {
            text-decoration: none;
            font-weight: 500;
            color: #0c2c50;
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
        }

        .download-box-thin .pdf-download:hover {
            text-decoration: underline;
        }

        @media (max-width: 640px) {
            .article-page {
                margin: 20px auto;
                padding: 12px;
            }

            .article-page h1 {
                font-size: 1.7rem;
            }

            .article-actions-top,
            .article-actions-bottom {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
    <!-- petit parseur markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>

<header class="site-header">
    <nav>
        <div class="logo">
            <img src="assets/img/logo-diploval.png" alt="Diploval Conseil">
        </div>
        <ul>
            <li><a href="index.html">Accueil</a></li>
            <li><a href="diplomag.html" class="active">Diplomag</a></li>
            <li><a href="mentions-legales.html">Mentions lÃ©gales</a></li>
        </ul>
    </nav>
</header>

<main class="article-page">
    <a href="diplomag.html" class="btn-secondary" style="margin-bottom: 10px;">&larr; Retour Ã  Diplomag</a>

    <h1 id="article-title"></h1>
    <div id="article-meta" class="article-meta-line"></div>

    <!-- ðŸ”¹ Bloc tÃ©lÃ©chargement PDF en haut -->
    <div id="article-download-box" class="download-box-thin" style="display:none;">
        <span class="download-icon">ðŸ“„</span>
        <a id="download-pdf" class="pdf-download" target="_blank" rel="noopener">
            TÃ©lÃ©charger lâ€™analyse en PDF
        </a>
    </div>

    <div class="article-actions-top">
        <button id="share-copy" class="btn-secondary" type="button">Copier le lien</button>
        <div class="share-buttons">
            <a id="share-fb" class="btn-secondary" target="_blank" rel="noopener">Facebook</a>
            <a id="share-li" class="btn-secondary" target="_blank" rel="noopener">LinkedIn</a>
            <a id="share-x" class="btn-secondary" target="_blank" rel="noopener">X</a>
        </div>
    </div>

    <div id="article-image"></div>
    <article id="article-body"></article>

    <div class="article-actions-bottom">
        <a href="diplomag.html" class="btn-secondary">&larr; Retour aux articles</a>
    </div>
</main>

<footer class="site-footer">
    <p>Â© 2025 Diploval Conseil â€” Tous droits rÃ©servÃ©s.</p>
    <p>Chambonas â€” ArdÃ¨che, France</p>
</footer>

<script>
async function loadArticle() {
    const params = new URLSearchParams(window.location.search);
    const slug = params.get("slug");
    if (!slug) {
        document.getElementById("article-title").innerText = "Article introuvable";
        return;
    }

    const res = await fetch("content/diplomag.json");
    const json = await res.json();
    const articles = json.items || [];
    const a = articles.find(item => item.slug === slug);

    if (!a) {
        document.getElementById("article-title").innerText = "Article introuvable";
        return;
    }

    document.title = (a.titre || "Article") + " â€“ Diplomag â€“ Diploval Conseil";

    document.getElementById("article-title").innerText = a.titre || "";
    document.getElementById("article-meta").innerText =
        (a.date || "") + " â€” " + (a.pays || "") + (a.theme ? " (" + a.theme + ")" : "");

    if (a.image) {
        document.getElementById("article-image").innerHTML =
            `<img src="${a.image}" alt="${a.titre || ''}">`;
    }

    const bodyHtml = a.body ? marked.parse(a.body) : "<p>(Article en cours de rÃ©daction)</p>";
    document.getElementById("article-body").innerHTML = bodyHtml;

    // ðŸ”¹ PDF : on affiche le bloc fin si un pdf_url existe
    if (a.pdf_url) {
        const dlBox = document.getElementById("article-download-box");
        const dl = document.getElementById("download-pdf");
        if (dlBox && dl) {
            dlBox.style.display = "inline-flex";
            dl.href = a.pdf_url;
        }
    }

    // Partage
    const pageUrl = encodeURIComponent(window.location.href);
    const pageTitle = encodeURIComponent(a.titre || "Article Diplomag");

    document.getElementById("share-fb").href =
        `https://www.facebook.com/sharer/sharer.php?u=${pageUrl}`;
    document.getElementById("share-li").href =
        `https://www.linkedin.com/sharing/share-offsite/?url=${pageUrl}`;
    document.getElementById("share-x").href =
        `https://twitter.com/intent/tweet?url=${pageUrl}&text=${pageTitle}`;

    document.getElementById("share-copy").onclick = async () => {
        try {
            await navigator.clipboard.writeText(window.location.href);
            alert("Lien copiÃ© dans le presse-papiers.");
        } catch {
            alert("Impossible de copier le lien, mais vous pouvez le sÃ©lectionner dans la barre dâ€™adresse.");
        }
    };
}

loadArticle();
</script>

</body>
</html>
